<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.min.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>


<script>

// set the dimensions and margins of the graph
var width = 800
var height = 800
var radius = width / 2 // radius of the dendrogram

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + (radius) + "," + (radius) + ")");

var stratify = d3.tree()
  .size([2 * Math.PI, radius-100])
  .separation((a, b) => (a.parent == b.parent ? 1 : 10) / a.depth)
  
// read json data
d3.json("data_dendrogram.json").then(function(data) {

  var sortData = d3.hierarchy(data)
    // .sort((a, b) => d3.ascending(a.data.name, b.data.name))
  console.log(sortData)


  var root = stratify(sortData)
  console.log(root);

  svg.append("g")
      .attr("fill", "none")
      // .attr("stroke", "#555")
      .attr("stroke-opacity", 0.4)
      .attr("stroke-width", 1.5)
    .selectAll("path")
    .data(root.links())
    .join("path")
      .attr("stroke", function(d){
        if(d.target.data.value==1){
          return "yellow";
        }
        if(d.target.data.value==2){
          return "pink";
        }
        if(d.target.data.value==12){
          return "orange"
        }
        if(d.target.data.name=="identity"){
          return "blue"
        }
        // if(d.target.data.value==undefined){
        //   return ""
        // }
        else{
          return "grey"
        }
      })
      .attr("opacity", .7)
      .attr("d", d3.linkRadial()
          .angle(d => d.x)
          .radius(d => d.y));


  svg.append("g")
      .selectAll("circle")
      .data(root.descendants())
      .join("circle")
      .filter(function(d){
        return d.data.value>0;
      })
        .attr("transform", d => `
          rotate(${d.x * 180 / Math.PI - 90})
          translate(${d.y},0)
        `)
        .attr("fill", function(d){
          if(d.data.total){
            console.log(d.data.total)
          }
        // console.log(d);
          if(d.data.value==1){
            return "yellow";
          }
          if(d.data.value==2){
            return "pink";
          }
          if(d.data.value==12){
            return "orange"
          }
          if(d.data.name=="identity"){
            return "blue"
          }
          // if(d.data.value==undefined){
          //   return "white"
          // }
          // if(d.children){
          //   return "pink"
          // } 
          // else{
          //   return "white"
          // }
         })
        .attr("opacity", .7)
        .attr("r", 2.5);

    svg.append("g")
        .attr("font-family", "sans-serif")
        .attr("font-size", 8)
        .attr("stroke-linejoin", "round")
        .attr("stroke-width", 3)
      .selectAll("text")
      .data(root.descendants())
      .join("text")
        .attr("transform", d => `
          rotate(${d.x * 180 / Math.PI - 90}) 
          translate(${d.y},0) 
          rotate(${d.x >= Math.PI ? 180 : 0})
        `)
        .attr("dy", "0.31em")
        // .attr("dy", "-0.9em")
        .attr("x", d => d.x < Math.PI === !d.children ? 6 : -6)
        .attr("text-anchor", d => d.x < Math.PI === !d.children ? "start" : "end")
        .attr("fill", function(d){
          // if(d.children){
          //   return "none"
          // }
          // if(!d.children){
          //   return "none"
          // }
          return "none";
        })
        .text(d => d.data.name)
      .clone(true).lower()
        // .attr("stroke", "white");      

})



</script>